{{- $siblings := (slice) -}}
{{- $ignoreWeight := .ignoreWeight | default false -}}
{{- with .Pages -}}
    {{- $siblingsTop := (.ByWeight).GroupBy "Weight" -}}
    {{- if $ignoreWeight -}}
        {{- range (.ByPublishDate).Reverse -}}
            {{- if ne .Params.omitFromList true -}}
                {{- $siblings = $siblings | append . -}}
            {{- end -}}
        {{- end -}}
    {{- else -}}
        {{- range $siblingsTop -}}
            {{- range (.Pages.ByPublishDate).Reverse -}}
                {{- if ne .Params.omitFromList true -}}
                    {{- $siblings = $siblings | append . -}}
                {{- end -}}
            {{- end -}}
        {{- end -}}
    {{- end -}}
{{- end -}}
{{- return $siblings -}}
{{- /* Remove trailing newlines */ -}}
